<html>
<meta name="viewport" content="initial-scale=1.0" />
<head><title>Camera Test</title></head>
<body>
<style>
  #video {
    width:300px;
    height:300px;
  }
</style>
  <h3 id="title"></h3>
	<p><video id="video" autoplay="autoplay" playsInline></video></p>
  <p>
    <button onclick='start({}, "Default")'>Default</button>
    <button onclick='start({focusMode: { ideal: "continuous" }}, "Continuous Focus")'>Continuous Focus</button>
    <br/>
    <button onclick='start({facingMode: "environment", focusMode: { ideal: "continuous" }, zoom: {ideal: 0.1}}, "Zoom 0.1")'>Zoom 0.1</button>    
    <button onclick='start({focusMode: { ideal: "continuous" }, zoom: {ideal: 0.5}}, "Zoom 0.5")'>Zoom 0.5</button>    
    <button onclick='start({focusMode: { ideal: "continuous" }, zoom: {ideal: 1.0}}, "Zoom 1.0")'>Zoom 1.0</button>    
    <button onclick='start({focusMode: { ideal: "continuous" }, zoom: {ideal: 2.0}}, "Zoom 2.0")'>Zoom 2.0</button>    
    <button onclick='start({focusMode: { ideal: "continuous" }, zoom: {ideal: 3.0}}, "Zoom 3.0")'>Zoom 3.0</button>        
  </p>
	<p><div id="preLog"></div></p>  
<script>
"use strict";
var video = document.getElementById('video');
var videoStream = null;
var preLog = document.getElementById('preLog');

function clearLog()
{
	if (preLog) preLog.innerHTML = "";
}

function log(text)
{
	if (preLog) preLog.innerHTML += ('<br/>' + text);
	else alert(text);
}

function noStream()
{
	log('Access to camera was denied!');
}

function stop()
{
	if (videoStream)
	{
		if (videoStream.stop) {
      videoStream.stop();
    }
		videoStream.onended = null;
		videoStream = null;
	}
	if (video)
	{
		video.onerror = null;
		video.pause();
		video.src = "";
	}
}

function gotStream(stream)
{
	videoStream = stream;
	log('Got stream.');
	video.onerror = function ()
	{
		log('video.onerror');
		if (video) stop();
	};
	stream.onended = noStream;
	video.srcObject = stream;
}
   
function start(constraints, variant)
{
    var finalConstraints = { ...{video:true, audio: false, frameRate: { ideal: 25, min: 10 }, facingMode: {ideal: "environment"}}, ...constraints }
    stop();
    clearLog();
    if (variant){
      document.getElementById("title").innerHTML=variant;
    }
		log('Get user media with constraints:' + JSON.stringify(finalConstraints));
		if (navigator.getUserMedia) {
    	navigator.getUserMedia(finalConstraints, gotStream, noStream);
    }
}

//{video:true, audio: false, facingMode: "environment", focusMode: "continuous"}
start({}, "Default");
</script>
</body>
</html>